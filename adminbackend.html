<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Commodity Trading - Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    /* Your existing admin CSS styles here - same as frontend or separate */
  </style>
</head>
<body>
  <button class="mode-toggle" onclick="toggleMode()" id="modeToggle">Switch to Frontend</button>

  <!-- Admin panel layout and sidebar similar to above -->

  <div class="admin-view active" id="adminView">
    <div class="admin-container">
      <div class="sidebar">
        <div class="sidebar-header">
          <h2>Admin Panel</h2>
          <p>Commodity Trading System</p>
        </div>
        <ul class="sidebar-menu">
          <li><a href="#" class="active" onclick="showSection('dashboard')">Dashboard</a></li>
          <li><a href="#" onclick="showSection('products')">Products</a></li>
          <li><a href="#" onclick="showSection('categories')">Categories</a></li>
          <li><a href="#" onclick="showSection('inquiries')">Inquiries</a></li>
          <li><a href="#" onclick="showSection('settings')">Settings</a></li>
        </ul>
      </div>

      <div class="main-content">
        <!-- Dashboard -->
        <div class="content-section active" id="dashboard">
          <h1>Dashboard</h1>
          <p>Basic stats here</p>
          <!-- Add stats grid as needed -->
          <div id="dashboardStats"></div>
        </div>

        <!-- Products -->
        <div class="content-section" id="products">
          <h1>Products Management</h1>
          <button onclick="openProductModal()">Add Product</button>
          <table id="productsTable">
            <thead>
              <tr><th>Name</th><th>Category</th><th>Capacity</th><th>Status</th><th>Actions</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Categories -->
        <div class="content-section" id="categories">
          <h1>Categories Management</h1>
          <button onclick="openCategoryModal()">Add Category</button>
          <table id="categoriesTable">
            <thead>
              <tr><th>Name</th><th>Description</th><th>Status</th><th>Actions</th></tr>
            </thead>
              <tbody></tbody>
          </table>
        </div>

        <!-- Inquiries -->
        <div class="content-section" id="inquiries">
          <h1>Customer Inquiries</h1>
          <table id="inquiriesTable">
            <thead>
              <tr><th>Company</th><th>Contact</th><th>Email</th><th>Interest</th><th>Date</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Settings -->
        <div class="content-section" id="settings">
          <h1>Settings</h1>
          <p>Coming soon</p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = 'https://kunrareegagtlxiudfa.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt1bnJhcmllZWdhZ3RreGl1ZGZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1MTIyMjgsImV4cCI6MjA3NTA4ODIyOH0.cAcKViNIT6qI5eFM18IDaWKWsAIfwQ3gvugFo0iWbaI';

    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const dataManager = { products: {}, categories: {}, inquiries: {} };

    document.addEventListener('DOMContentLoaded', () => {
      loadAllDataFromSupabase();
    });

    async function loadAllDataFromSupabase() {
      try {
        const {  categories } = await supabaseClient.from('categories').select('*');
        const {  products } = await supabaseClient.from('products').select('*');
        const {  inquiries } = await supabaseClient.from('inquiries').select('*');

        dataManager.categories = categories.reduce((acc, c) => ((acc[c.id] = c), acc), {});
        dataManager.products = products.reduce((acc, p) => ((acc[p.id] = p), acc), {});
        dataManager.inquiries = inquiries.reduce((acc, i) => ((acc[i.id] = i), acc), {});

        renderAllAdmin();
      } catch (e) {
        console.error('Error loading admin ', e);
      }
    }

    function renderAllAdmin() {
      renderDashboard();
      renderProducts();
      renderCategoriesAdmin();
      renderInquiries();
    }

    function renderDashboard() {
      const totalProducts = Object.keys(dataManager.products).length;
      const totalCategories = Object.keys(dataManager.categories).length;
      const totalInquiries = Object.keys(dataManager.inquiries).length;
      const activeProducts = Object.values(dataManager.products).filter(p => p.status === 'active').length;

      document.getElementById('dashboardStats').innerHTML = `
        <div>Total Products: ${totalProducts}</div>
        <div>Total Categories: ${totalCategories}</div>
        <div>Total Inquiries: ${totalInquiries}</div>
        <div>Active Products: ${activeProducts}</div>
      `;
    }

    function renderProducts() {
      const tbody = document.querySelector('#productsTable tbody');
      if (!tbody) return;
      tbody.innerHTML = '';
      Object.values(dataManager.products).forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.title}</td>
          <td>${dataManager.categories[p.category]?.name || p.category}</td>
          <td>${p.monthly_capacity || ''}</td>
          <td>${p.status}</td>
          <td>
            <button onclick="editProduct('${p.id}')">Edit</button>
            <button onclick="deleteProduct('${p.id}')">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function renderCategoriesAdmin() {
      const tbody = document.querySelector('#categoriesTable tbody');
      if (!tbody) return;
      tbody.innerHTML = '';
      Object.values(dataManager.categories).forEach(c => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${c.name}</td>
          <td>${c.description}</td>
          <td>${c.status || 'active'}</td>
          <td>
            <button onclick="editCategory('${c.id}')">Edit</button>
            <button onclick="deleteCategory('${c.id}')">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function renderInquiries() {
      const tbody = document.querySelector('#inquiriesTable tbody');
      if (!tbody) return;
      tbody.innerHTML = '';
      Object.values(dataManager.inquiries).forEach(i => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i.company}</td>
          <td>${i.contact}</td>
          <td>${i.email}</td>
          <td>${i.interest}</td>
          <td>${new Date(i.date).toLocaleDateString()}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Additional admin functions (edit, delete, modal open/close, etc.) needed here

    // Mode Toggle and Section Navigation Functions same as frontend part

  </script>
</body>
</html>
