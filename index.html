<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Commodity Trading Frontend</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    /* Your existing frontend CSS styles here */
  </style>
</head>
<body>
  <button class="mode-toggle" onclick="toggleMode()" id="modeToggle">Switch to Admin</button>

  <div class="frontend-view active" id="frontendView">
    <div class="frontend-container">
      <!-- Search Section -->
      <div class="search-section">
        <div class="search-bar">
          <input type="text" class="search-input" placeholder="Search products, categories, or specifications..." id="searchInput" />
          <button class="search-button" onclick="searchProducts()">Search</button>
        </div>
        <div class="category-filters" id="categoryFilters">
          <!-- Category filters dynamically loaded here -->
        </div>
      </div>

      <!-- Product Categories Grid -->
      <div class="products-grid" id="productsGrid">
        <!-- Categories will be populated here -->
      </div>

      <!-- No Results Message -->
      <div id="noResults" class="no-results" style="display:none;">
        No products found matching your search criteria.
      </div>

      <!-- Innovation, Contact Sections (Same as admin's) -->

      <!-- Add the rest of your frontend HTML content (innovation lab, contact info, forms) here -->

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase configuration
    const SUPABASE_URL = 'https://kunrareegagtlxiudfa.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt1bnJhcmllZWdhZ3RreGl1ZGZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1MTIyMjgsImV4cCI6MjA3NTA4ODIyOH0.cAcKViNIT6qI5eFM18IDaWKWsAIfwQ3gvugFo0iWbaI';

    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let allProducts = [];
    let allCategories = [];

    document.addEventListener('DOMContentLoaded', () => {
      loadDataFromSupabase();
      document.getElementById('searchInput').addEventListener('input', event => {
        if (event.target.value.length > 0) searchProducts();
        else {
          document.querySelectorAll('.category-card').forEach(card => (card.style.display = 'block'));
          document.getElementById('noResults').style.display = 'none';
        }
      });
    });

    async function loadDataFromSupabase() {
      try {
        const {  categories, error: catError } = await supabaseClient.from('categories').select('*');
        if (catError) throw catError;
        allCategories = categories || [];

        const {  products, error: prodError } = await supabaseClient.from('products').select('*').eq('status', 'active');
        if (prodError) throw prodError;
        allProducts = products || [];

        renderFrontend();
      } catch (error) {
        console.error('Error loading frontend ', error);
        loadDefaultData();
      }
    }

    function loadDefaultData() {
      allCategories = [
        { id: 'proteins', name: 'Sustainable Proteins', description: 'High-quality proteins derived from waste...' },
        { id: 'catalysts', name: 'Advanced Catalysts', description: 'Innovative catalysts from industrial waste streams...' }
      ];

      allProducts = [
        {
          id: 'poultry-protein',
          title: 'Poultry Waste-Derived Protein',
          category: 'proteins',
          monthly_capacity: '50 tons/month',
          overview: 'High-quality protein extracted from poultry waste streams',
          status: 'active'
        },
        {
          id: 'algae-protein',
          title: 'Algae-Based Protein',
          category: 'proteins',
          monthly_capacity: '25 tons/month',
          overview: 'Sustainable protein derived from specially cultivated algae strains',
          status: 'active'
        }
      ];

      renderFrontend();
    }

    function renderFrontend() {
      renderCategories();
      renderCategoryFilters();
      renderFormOptions();
    }

    function renderCategories() {
      const grid = document.getElementById('productsGrid');
      const categoryGroups = {};
      allProducts.forEach(product => {
        if (!categoryGroups[product.category]) categoryGroups[product.category] = [];
        categoryGroups[product.category].push(product);
      });

      let html = '';
      allCategories.forEach(category => {
        if (!category.status || category.status === 'active') {
          const products = categoryGroups[category.id] || [];
          html += `<div class="category-card" data-category="${category.id}">
            <div class="category-header">
              <h3 class="category-title">${category.name}</h3>
              <span class="product-count">${products.length} products</span>
            </div>
            <ul class="product-list">
              ${products.map(product => `
                <li class="product-item" onclick="openProductModal('${product.id}');event.stopPropagation()">
                  <div class="product-name">${product.title}</div>
                  <div class="product-capacity">Capacity: ${product.monthly_capacity || 'N/A'}</div>
                </li>`).join('')}
            </ul>
          </div>`;
        }
      });
      grid.innerHTML = html;
    }

    function renderCategoryFilters() {
      const container = document.getElementById('categoryFilters');
      let html = `<button class="filter-btn active" onclick="filterCategory('all')">All Categories</button>`;
      allCategories.forEach(c => {
        if (!c.status || c.status === 'active') {
          html += `<button class="filter-btn" onclick="filterCategory('${c.id}')">${c.name}</button>`;
        }
      });
      container.innerHTML = html;
    }

    function renderFormOptions() {
      const interestSelect = document.querySelector('select[name="interest"]');
      const materialSelect = document.querySelector('select[name="material"]');
      let interestOptions = '<option value="">Select Category</option>';
      let materialOptions = '<option value="">Select Material</option>';

      allCategories.forEach(c => {
        if (!c.status || c.status === 'active') {
          interestOptions += `<option value="${c.id}">${c.name}</option>`;

          const products = allProducts.filter(p => p.category === c.id && p.status === 'active');
          if (products.length) {
            materialOptions += `<optgroup label="${c.name}">`;
            products.forEach(p => (materialOptions += `<option value="${p.id}">${p.title}</option>`));
            materialOptions += '</optgroup>';
          }
        }
      });
      interestOptions += '<option value="custom">Custom Development</option>';
      materialOptions += '<option value="Custom Material Development">Custom Material Development</option><option value="Pilot Program">Pilot Program</option>';

      if (interestSelect) interestSelect.innerHTML = interestOptions;
      if (materialSelect) materialSelect.innerHTML = materialOptions;
    }

    // Modal, search, filter, form submission functions omitted for brevity (same as explained above)
    // ... add code for openProductModal, closeProductModal, filterCategory, searchProducts, openQuoteModal,
    // closeQuoteModal, submitForm, submitQuoteForm etc. from prior answer to complete here.

  </script>
</body>
</html>
